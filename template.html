<script src="/static/js/vendor/jquery.serializeJSON.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js" type="text/javascript"></script>
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

<!-- Start of the survey modals -->
<div id="survey" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Do you want to help us?</h4>
            </div>
            <div class="modal-body">
                Thanks for contributing one task for the project. We are interested in knowing how you found out about
                us.
                <strong>Could you please answer two questions in a short survey?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
                <a class="btn btn-large btn-success"
                   href="https://docs.google.com/forms/d/1Kgw8cvcufm-77PC2t_PL_b4y1_Tb9wJseimmb3cQIn4/viewform?embedded=true">Of
                    course!
                    Take me to the survey!</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->

<div id="survey25" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Congratulations for completing 25 tasks!</h4>
            </div>
            <div class="modal-body">
                Thanks for contributing 25 tasks for the project. Now that you have been using MicroPasts for a while,
                we would like to know how you found it. <strong>Could you please answer a few questions in a short
                survey?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
                <a class="btn btn-large btn-success"
                   href="https://docs.google.com/forms/d/1uczUGGYbrQ2FQfTtM8j4vfGr2qwcCMW6PLwzfvZZ6kI/viewform?embedded=true">Of
                    course! Take me to the survey!</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- End of the survey modals -->

<!-- Browser not compatible message -->
<div style="display:none;margin-top:15px; height:500px;" id="oldbrowser" class="row">
    <!-- Success and Error Messages for the user -->
    <div  class="col-md-8 col-md-offset-1 alert alert-info">
        <strong>Sorry, but your browser does not support the current application. If you want to contribute, please,
            upgrade to a modern web browser like the open source and free alternative
            <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a></strong>.
    </div>
</div> <!-- End of Row -->
<!-- end of browser -->

<!-- Start of messages -->
<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Well done!</strong> You have successfully submitted your transcription. Here is another to try if you wish!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Loading next task...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>The task has been completed!</strong> Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>Congratulations!</h2>
          <p>
              You have participated in all available tasks!
          </p>
          <img src="https://crowdfunded.micropasts.org/assets/logo-head.png"
               height="200" width="200" alt="The MicroPasts Square Logo"/>
          <div class="alert-actions">
             <a class="btn-default btn" href="/">Go back to the home page</a>
             <a class="btn-default btn" href="/app">or, have a look at our
                 other applications</a>
          </div>
    </div>
    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">Ã—</a>
        <strong>Error!</strong> Something went wrong, please contact the site administrators
    </div>
</div>
<!-- End Success and Error Messages for the user -->

<!-- DOM skeleton row -->

<div class="row skeleton">

    <!-- Present the image and the base metadata loaded from RDF -->
    <div class="row">
        <img width="150px" src="https://pbs.twimg.com/profile_images/457199979115732992/PqXVloa1.png" class="pull-right" alt="The project Andvari logo" />

        <div class="btn-group">
            <a data-toggle="modal" data-target="#myModal" class="btn btn-xs btn-info" href="#">Tutorial</a>
            <a target="_blank" data-toggle="tooltip" data-placement="top"
               title="Opens in a new window" href="http://community.micropasts.org/category/crowd-sourcing-support" class="btn btn-xs btn-info" id="support">Community support</a>
            <a class="btn btn-xs btn-info" id="url">Original record</a>
            <a class="btn btn-xs btn-info" id="rdf">RDF representation</a>
            <a class="btn btn-xs btn-info fancybox" id="overlay">Overlay image</a>
            <a class="btn btn-xs btn-info" id="download">Download image</a>
        </div>
    </div>

    <!-- Present tagging interface -->
    <div class="row" id="markUp">
        <div class="col-md-6">
            <form>
                <!-- Enter drop down semantics here -->
                <select id="activities" class="multiselect" multiple="multiple">
                    <option value="agriculture">agriculture</option>
                    <option value="craft">craft</option>
                    <option value="dance">dance</option>
                    <option value="excavation">excavation</option>
                    <option value="field_camp">field camp</option>
                    <option value="food_preparation">food preparation</option>
                    <option value="food_serving">food serving</option>
                    <option value="horticulture">horticulture</option>
                    <option value="hunting">hunting</option>
                    <option value="initiation">initiation</option>
                    <option value="landscape">landscape</option>
                    <option value="mining">mining</option>
                    <option value="procession">procession</option>
                    <option value="reconstruction">reconstruction</option>
                    <option value="recreation">recreation</option>
                    <option value="religion">religion</option>
                    <option value="site_view">site view</option>
                    <option value="slavery">slavery</option>
                    <option value="sport">sport</option>
                    <option value="surveying">surveying</option>
                    <option value="time_keeping">time keeping</option>
                    <option value="trade">trade</option>
                    <option value="transport">transport</option>
                    <option value="warfare">warfare</option>
                    <option value="wedding">wedding</option>
                </select>

                <!-- The things type dropdown -->
                <select id="things" class="multiselect" multiple="multiple">
                    <option value="aeroplane">aeroplane</option>
                    <option value="altar">altar</option>
                    <option value="animal">animal</option>
                    <option value="ape">ape</option>
                    <option value="apse">apse</option>
                    <option value="aqueduct">aqueduct</option>
                    <option value="arch">arch</option>
                    <option value="architrave">architrave</option>
                    <option value="axe">axe</option>
                    <option value="bailey">bailey</option>
                    <option value="basin">basin</option>
                    <option value="basket">basket</option>
                    <option value="bell">bell</option>
                    <option value="bicycle">bicycle</option>
                    <option value="bird">bird</option>
                    <option value="boat">boat</option>
                    <option value="bookcase">bookcase</option>
                    <option value="bow">bow</option>
                    <option value="branch">branch</option>
                    <option value="bridge">bridge</option>
                    <option value="building">building</option>
                    <option value="camel">camel</option>
                    <option value="car">car</option>
                    <option value="carrying_chair">carrying-chair</option>
                    <option value="cart">cart</option>
                    <option value="castle">castle</option>
                    <option value="cemetery">cemetery</option>
                    <option value="chair">chair</option>
                    <option value="chicken">chicken</option>
                    <option value="church">church</option>
                    <option value="cistern">cistern</option>
                    <option value="coffin">coffin</option>
                    <option value="columbarium">columbarium</option>
                    <option value="column">column</option>
                    <option value="column_capital">column capital</option>
                    <option value="cornice">cornice</option>
                    <option value="courtyard">courtyard</option>
                    <option value="cow">cow</option>
                    <option value="crocodile">crocodile</option>
                    <option value="dagger">dagger</option>
                    <option value="dam">dam</option>
                    <option value="dighouse">dighouse</option>
                    <option value="dog">dog</option>
                    <option value="dolmen">dolmen</option>
                    <option value="donkey">donkey</option>
                    <option value="door">door</option>
                    <option value="field">field</option>
                    <option value="fish">fish</option>
                    <option value="flag">flag</option>
                    <option value="fortress">fortress</option>
                    <option value="frieze">frieze</option>
                    <option value="furniture">furniture</option>
                    <option value="garden">garden</option>
                    <option value="gateway">gateway</option>
                    <option value="gun">gun</option>
                    <option value="horse">horse</option>
                    <option value="house">house</option>
                    <option value="hut">hut</option>
                    <option value="inscription">inscription</option>
                    <option value="island">island</option>
                    <option value="jewelry">jewelry</option>
                    <option value="ladder">ladder</option>
                    <option value="latrine">latrine</option>
                    <option value="lion">lion</option>
                    <option value="market">market</option>
                    <option value="milestone">milestone</option>
                    <option value="monastery">monastery</option>
                    <option value="monolith">monolith</option>
                    <option value="mosaic">mosaic</option>
                    <option value="mosque">mosque</option>
                    <option value="mountain">mountain</option>
                    <option value="museum">museum</option>
                    <option value="ostrich">ostrich</option>
                    <option value="ox">ox</option>
                    <option value="palace">palace</option>
                    <option value="pediment">pediment</option>
                    <option value="plant">plant</option>
                    <option value="pulpit">pulpit</option>
                    <option value="quadruped">quadruped</option>
                    <option value="railway">railway</option>
                    <option value="river">river</option>
                    <option value="reed">reed</option>
                    <option value="relief">relief</option>
                    <option value="reservoir">reservoir</option>
                    <option value="road">road</option>
                    <option value="rock">rock</option>
                    <option value="room">room</option>
                    <option value="scaffolding">scaffolding</option>
                    <option value="sceptre">sceptre</option>
                    <option value="school">school</option>
                    <option value="scorpion">scorpion</option>
                    <option value="sea">sea</option>
                    <option value="shrine">shrine</option>
                    <option value="skull">skull</option>
                    <option value="skeleton">skeleton</option>
                    <option value="slag">slag</option>
                    <option value="snake">snake</option>
                    <option value="spear">spear</option>
                    <option value="spring">spring</option>
                    <option value="stairs">stairs</option>
                    <option value="statue">statue</option>
                    <option value="stela">stela</option>
                    <option value="street">street</option>
                    <option value="sundial">sundial</option>
                    <option value="synagogue">synagogue</option>
                    <option value="table">table</option>
                    <option value="temple">temple</option>
                    <option value="tent">tent</option>
                    <option value="tetrapylon">tetrapylon</option>
                    <option value="theatre">theatre</option>
                    <option value="throne">throne</option>
                    <option value="tomb">tomb</option>
                    <option value="tortoise">tortoise</option>
                    <option value="tower">tower</option>
                    <option value="tree">tree</option>
                    <option value="truck">truck</option>
                    <option value="umbrella">umbrella</option>
                    <option value="vault">vault</option>
                    <option value="vessel">vessel</option>
                    <option value="wall">wall</option>
                    <option value="wall_painting">wall painting</option>
                    <option value="water_wheel">water wheel</option>
                    <option value="weaving">weaving</option>
                    <option value="well">well</option>
                    <option value="window">window</option>
                </select>

                <!-- The theme type dropdown -->
                <select id="theme" class="multiselect" multiple="multiple">
                    <option value="animal">animal</option>
                    <option value="architecture">architecture</option>
                    <option value="armour">armour</option>
                    <option value="container">container</option>
                    <option value="funerary">funerary</option>
                    <option value="furniture">furniture</option>
                    <option value="horology">horology</option>
                    <option value="manufacture">manufacture</option>
                    <option value="musical_instrument">musical instrument</option>
                    <option value="panorama">panorama</option>
                    <option value="personal_accessory">personal accessory</option>
                    <option value="plant">plant</option>
                    <option value="recreation">recreation</option>
                    <option value="sculpture">sculpture</option>
                    <option value="tool">tool</option>
                    <option value="transport">transport</option>
                    <option value="water_management">water management</option>
                    <option value="weapons">weapons</option>
                    <option value="writing">writing</option>
                </select>

                <!-- The people dropdown -->
                <select id="people" class="multiselect" multiple="multiple">
                    <option value="American">American</option>
                    <option value="Arab">Arab</option>
                    <option value="Bedouin">Bedouin</option>
                    <option value="Egyptian">Egyptian</option>
                    <option value="European">European</option>
                </select>
                <!-- End of test dropdowns --> 
            </form>
        </div>
        <div class="col-md-6">
             <div id="imgHolder" class="pull-right">
                <div id="img">
                    <img class="img-polaroid andImage" id="image_url"/>
                </div>
            </div>
        </div>
        <!-- Comments on task -->
        <div class="form-group">
            <label class="control-label" for="comments">Please add your comments (concerns, suggestions, problems etc)</label>
            <textarea class="form-control" rows="5"  id="comments" name="comments" placeholder="Add any comments you have"></textarea>
        </div>
    </div>
    <!-- Present submission -->
    <button class="btn btn-success btn-answer" value='Yes'>Submit the transcription</button>

    <!-- Progress section -->
    <p>
        You are working now on task: <span id="task-id" class="label label-warning">#</span>
    </p>
    <p>
        You have completed: <span id="done" class="label label-info"></span> tasks from
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span>
    </p>
    <div class="progress progress-striped">
        <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
    </div>

</div>

<!-- End of skeleton row -->

<!-- Start of tutorial modals -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal header -->
            <div class="modal-header">
                <h3>Linked Open Data exercise for Project Andvari</h3>
            </div>

            <!-- Step 1 of the tutorial -->
            <div id="0" class="modal-body" style="display:none">

            </div>

            <!-- Step 2 of the tutorial -->
            <div id="1" class="modal-body" style="display:none">

            </div>

            <!-- Step 2 of the tutorial -->
            <div id="2" class="modal-body" style="display:none">

            </div>
            <!-- End of stepped modal body -->

            <!-- Modal footer -->
            <div class="modal-footer">
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <button id="startContrib" data-dismiss="modal" class="btn btn-primary" style="display:none"/></a>
                <i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
            </div>
        </div>
    </div>
</div>
<!-- End of tutorial modals -->

<!-- Client side scripts -->

<script type="text/javascript">
// Quick fix for IE8
Modernizr.load({
  test: window.JSON,
  nope: '/static/js/vendor/json2.min.js'
});
</script>
<!-- Step through modals -->
<script type="text/javascript">
    var step = -1;
    function showStep(action) {
        $("#" + step).hide();
        if (action == 'next') {
            step = step + 1;
        }
        if (action == 'prev') {
            step = step - 1;
        }
        if (step == 0) {
            $("#prevBtn").hide();
        }
        else {
            $("#prevBtn").show();
        }

        if (step == 2) {
            $("#nextBtn").hide();
            $("#startContrib").show();
        }
        $("#" + step).show();
    }

    showStep('next');
    $("#modal").modal('show');
</script>

<!-- Load user progress -->
<script type="text/javascript">
    function loadUserProgress() {
        pybossa.userProgress('andvari').done(function(data){
            console.log("Total answers done for user: " + data.done);
            if ((data.done == 1) && ($.cookie('surveyAndvari') == undefined)){
               $("#survey").modal('show');
               $.cookie('surveyAndvari', 'shown', { path: '/'});
            }
            if ((data.done >= 25) && ($.cookie('survey25Andvari') == undefined)){
                $("#survey25").modal('show');
                $.cookie('survey25Andvari', 'shown', { path: '/'});
            }
            var pct = Math.round((data.done*100)/data.total);
            $("#progress").css("width", pct.toString() +"%");
            $("#progress").attr("title", pct.toString() + "% completed!");
            $("#progress").tooltip({'placement': 'left'});
            $("#total").text(data.total);
            $("#done").text(data.done);
            $('a[rel]').tooltip({'placement': 'left'});
        });
    }
</script>

<script type="text/javascript">
        pybossa.taskLoaded(function(task, deferred) {
        if ( ! $.isEmptyObject(task) ) {
            loadUserProgress();
            console.log("User progress loading now and deferred task resolve loading");
            deferred.resolve(task);
        } else {
            console.log("Deferred task loading as task was empty");
            deferred.resolve(task);
        }
    });
</script>

<script type="text/javascript">
    pybossa.presentTask(function(task, deferred) {
        if ( !$.isEmptyObject(task) ) {
            $("#question").html(task.info.question);
            $('#task-id').html(task.id);
            $("a#overlay").attr("href", task.info.img_url);
            $("a#url").attr("href", task.info.display_url);
            $("a#rdf").attr("href", task.info.uri);
            $("a#download").attr("download", task.id);
            $("a#download").attr("href", task.info.img_url);
            $('#support').tooltip({'placement': 'top'});
            $('#image_url').attr("src", task.info.img_url);
            $(".fancybox").fancybox();

            $('.btn-answer').off('click').on('click', function(evt) {
                evt.preventDefault();
                var answer = $(evt.target).attr("value");
                if (typeof answer != 'undefined') {
                    task.answer = $("#markUp").serializeJSON();
                    console.log(task.answer);
                    console.log(data);
                    task.answer.transcription = data;
                    task.answer.comments = $("#comments").val();
                    console.log(task.answer);
                    pybossa.saveTask(task.id, task.answer).done(function() {
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        $("#success").fadeIn(500).fadeOut(500);
                        $("#loading").fadeIn(500).fadeOut(500);
                        $('#comments').val('');
                        deferred.resolve();
                    });
                } else {
                    $("#error").show();
                }
            });
            $("#loading").hide();
        } else {
            $(".skeleton").hide();
            $("#loading").hide();
            $("#finish").fadeIn(500);
        }
    });
    pybossa.run('andvari');
    </script>

</script>

<!-- Check if window resized and log to console -->
<script type="text/javascript">
     $(window).resize(function(){
        console.log('Window resized');
      });
</script>


<!-- App css -->
<style type="text/css">
    .btn-answer {
    margin-top: 10px;
    margin-bottom: 10px;
    }
    .btn-group {
    margin-bottom: 0px
    }
    .row {
    margin-left: 0px;
    margin-right: 0px;
    }
    .andImage {
    max-height:500px;
    }
</style>