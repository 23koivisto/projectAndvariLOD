<script src="/static/js/vendor/jquery.serializeJSON.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js" type="text/javascript"></script>
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

<!-- Start of the survey modals -->
<div id="survey" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Do you want to help us?</h4>
            </div>
            <div class="modal-body">
                Thanks for contributing one task for the project. We are interested in knowing how you found out about
                us.
                <strong>Could you please answer two questions in a short survey?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
                <a class="btn btn-large btn-success"
                   href="https://docs.google.com/forms/d/1Kgw8cvcufm-77PC2t_PL_b4y1_Tb9wJseimmb3cQIn4/viewform?embedded=true">Of
                    course!
                    Take me to the survey!</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->

<div id="survey25" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Congratulations for completing 25 tasks!</h4>
            </div>
            <div class="modal-body">
                Thanks for contributing 25 tasks for the project. Now that you have been using MicroPasts for a while,
                we would like to know how you found it. <strong>Could you please answer a few questions in a short
                survey?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
                <a class="btn btn-large btn-success"
                   href="https://docs.google.com/forms/d/1uczUGGYbrQ2FQfTtM8j4vfGr2qwcCMW6PLwzfvZZ6kI/viewform?embedded=true">Of
                    course! Take me to the survey!</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- End of the survey modals -->

<!-- Browser not compatible message -->
<div style="display:none;margin-top:15px; height:500px;" id="oldbrowser" class="row">
    <!-- Success and Error Messages for the user -->
    <div  class="col-md-8 col-md-offset-1 alert alert-info">
        <strong>Sorry, but your browser does not support the current application. If you want to contribute, please,
            upgrade to a modern web browser like the open source and free alternative
            <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a></strong>.
    </div>
</div> <!-- End of Row -->
<!-- end of browser -->

<!-- Start of messages -->
<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Well done!</strong> You have successfully submitted your transcription. Here is another to try if you wish!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Loading next task...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>The task has been completed!</strong> Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>Congratulations!</h2>
          <p>
              You have participated in all available tasks!
          </p>
          <img src="https://crowdfunded.micropasts.org/assets/logo-head.png"
               height="200" width="200" alt="The MicroPasts Square Logo"/>
          <div class="alert-actions">
             <a class="btn-default btn" href="/">Go back to the home page</a>
             <a class="btn-default btn" href="/app">or, have a look at our
                 other applications</a>
          </div>
    </div>
    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">Ã—</a>
        <strong>Error!</strong> Something went wrong, please contact the site administrators
    </div>
</div>
<!-- End Success and Error Messages for the user -->

<!-- DOM skeleton row -->

<div class="row skeleton">

    <!-- Present the image and the base metadata loaded from RDF -->
    <div class="row">
        <img width="150px" src="https://pbs.twimg.com/profile_images/457199979115732992/PqXVloa1.png" class="pull-right" alt="The project Andvari logo" />

        <div class="btn-group">
            <a data-toggle="modal" data-target="#myModal" class="btn btn-xs btn-info" href="#">Tutorial</a>
            <a target="_blank" data-toggle="tooltip" data-placement="top"
               title="Opens in a new window" href="http://community.micropasts.org/category/crowd-sourcing-support" class="btn btn-xs btn-info" id="support">Community support</a>
            <a class="btn btn-xs btn-info" id="url">Original record</a>
            <a class="btn btn-xs btn-info" id="rdf">RDF representation</a>
            <a class="btn btn-xs btn-info fancybox" id="overlay">Overlay image</a>
            <a class="btn btn-xs btn-info" id="download">Download image</a>
        </div>
    </div>

    <!-- Present tagging interface -->
    <div class="row" id="markUp">

        <form>
            <!-- Enter drop down semantics here -->
        </form>
         <div id="imgHolder" class="pull-right">
            <div id="img">
                <img src class="img-polaroid andImage"  id="image_url"/>
            </div>
        </div>
        <!-- Comments on task -->
        <div class="form-group">
            <label class="control-label" for="comments">Please add your comments (concerns, suggestions, problems etc)</label>
            <textarea class="form-control" rows="5"  id="comments" name="comments" placeholder="Add any comments you have"></textarea>
        </div>
    </div>
    <!-- Present submission -->
    <button class="btn btn-success btn-answer" value='Yes'>Submit the transcription</button>

    <!-- Progress section -->
    <p>
        You are working now on task: <span id="task-id" class="label label-warning">#</span>
    </p>
    <p>
        You have completed: <span id="done" class="label label-info"></span> tasks from
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span>
    </p>
    <div class="progress progress-striped">
        <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
    </div>

</div>

<!-- End of skeleton row -->

<!-- Start of tutorial modals -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal header -->
            <div class="modal-header">
                <h3>Linked Open Data exercise for Project Andvari</h3>
            </div>

            <!-- Step 1 of the tutorial -->
            <div id="0" class="modal-body" style="display:none">

            </div>

            <!-- Step 2 of the tutorial -->
            <div id="1" class="modal-body" style="display:none">

            </div>

            <!-- Step 2 of the tutorial -->
            <div id="2" class="modal-body" style="display:none">

            </div>
            <!-- End of stepped modal body -->

            <!-- Modal footer -->
            <div class="modal-footer">
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <button id="startContrib" data-dismiss="modal" class="btn btn-primary" style="display:none"/></a>
                <i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
            </div>
        </div>
    </div>
</div>
<!-- End of tutorial modals -->

<!-- Client side scripts -->

<script type="text/javascript">
// Quick fix for IE8
Modernizr.load({
  test: window.JSON,
  nope: '/static/js/vendor/json2.min.js'
});
</script>
<!-- Step through modals -->
<script type="text/javascript">
    var step = -1;
    function showStep(action) {
        $("#" + step).hide();
        if (action == 'next') {
            step = step + 1;
        }
        if (action == 'prev') {
            step = step - 1;
        }
        if (step == 0) {
            $("#prevBtn").hide();
        }
        else {
            $("#prevBtn").show();
        }

        if (step == 2) {
            $("#nextBtn").hide();
            $("#startContrib").show();
        }
        $("#" + step).show();
    }

    showStep('next');
    $("#modal").modal('show');
</script>

<!-- Load user progress -->
<script type="text/javascript">
    function loadUserProgress() {
        pybossa.userProgress('andvari').done(function(data){
            console.log("Total answers done for user: " + data.done);
            if ((data.done == 1) && ($.cookie('surveyAndvari') == undefined)){
               $("#survey").modal('show');
               $.cookie('surveyAndvari', 'shown', { path: '/'});
            }
            if ((data.done >= 25) && ($.cookie('survey25Andvari') == undefined)){
                $("#survey25").modal('show');
                $.cookie('survey25Andvari', 'shown', { path: '/'});
            }
            var pct = Math.round((data.done*100)/data.total);
            $("#progress").css("width", pct.toString() +"%");
            $("#progress").attr("title", pct.toString() + "% completed!");
            $("#progress").tooltip({'placement': 'left'});
            $("#total").text(data.total);
            $("#done").text(data.done);
            $('a[rel]').tooltip({'placement': 'left'});
        });
    }
</script>

<script type="text/javascript">
        pybossa.taskLoaded(function(task, deferred) {
        if ( ! $.isEmptyObject(task) ) {
            loadUserProgress();
            console.log("User progress loading now and deferred task resolve loading");
            deferred.resolve(task);
        } else {
            console.log("Deferred task loading as task was empty");
            deferred.resolve(task);
        }
    });
</script>

<script type="text/javascript">
    pybossa.presentTask(function(task, deferred) {
        if ( !$.isEmptyObject(task) ) {
            $("#question").html(task.info.question);
            $('#task-id').html(task.id);
            $("a#overlay").attr("href", task.info.img_url);
            $("a#url").attr("href", task.info.display_url);
            $("a#rdf").attr("href", task.info.uri);
            $("a#download").attr("download", task.id);
            $("a#download").attr("href", task.info.img_url);
            $('#support').tooltip({'placement': 'top'});
            $('#image_url').attr("src", task.info.img_url);
            $(".fancybox").fancybox();

            $('.btn-answer').off('click').on('click', function(evt) {
                evt.preventDefault();
                var answer = $(evt.target).attr("value");
                if (typeof answer != 'undefined') {
                    task.answer = $("#markUp").serializeJSON();
                    console.log(task.answer);
                    console.log(data);
                    task.answer.transcription = data;
                    task.answer.comments = $("#comments").val();
                    console.log(task.answer);
                    pybossa.saveTask(task.id, task.answer).done(function() {
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        $("#success").fadeIn(500).fadeOut(500);
                        $("#loading").fadeIn(500).fadeOut(500);
                        $('#comments').val('');
                        deferred.resolve();
                    });
                } else {
                    $("#error").show();
                }
            });
            $("#loading").hide();
        } else {
            $(".skeleton").hide();
            $("#loading").hide();
            $("#finish").fadeIn(500);
        }
    });
    pybossa.run('andvari');
    </script>

</script>

<!-- Check if window resized and log to console -->
<script type="text/javascript">
     $(window).resize(function(){
        console.log('Window resized');
      });
</script>


<!-- App css -->
<style type="text/css">
    .btn-answer {
    margin-top: 10px;
    margin-bottom: 10px;
    }
    .btn-group {
    margin-bottom: 0px
    }
    .row {
    margin-left: 0px;
    margin-right: 0px;
    }
    .andImage {
    max-height:500px;
    }
</style>